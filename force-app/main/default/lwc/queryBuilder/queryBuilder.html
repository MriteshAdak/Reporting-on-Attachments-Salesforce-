<template>
  <lightning-card title="Query Builder" icon-name="standard:search">
    <div class="slds-var-p-around_medium">
      <lightning-combobox
        name="object"
        label="Select Object"
        value={selectedObject}
        options={objectOptions}
        onchange={handleObjectChange}
        required
      >
      </lightning-combobox>

      <lightning-dual-listbox
        name="fields"
        label="Select Fields"
        source-label="Available Fields"
        selected-label="Selected Fields"
        options={fieldOptions}
        value={selectedFields}
        onchange={handleFieldChange}
        required
        class="slds-var-m-top_small"
        disabled={isLoading}
      >
      </lightning-dual-listbox>

      <div class="slds-m-top_medium">
        <div class="slds-grid">
          <div class="slds-m-top_small slds-text-color_weak">
            <p>Filter by field values</p>
          </div>
          <div class="slds-col_bump-left">
            <lightning-button
              label="Add Condition"
              icon-name="utility:add"
              onclick={handleAddFilter}
              disabled={isLoading}
            >
            </lightning-button>
          </div>
        </div>

        <template if:true={filters.length}>
          <div class="slds-m-top_small">
            <template for:each={filters} for:item="filter">
              <div
                key={filter.id}
                class="slds-grid slds-gutters slds-m-bottom_small slds-grid_vertical-align-end"
              >
                <div class="slds-col slds-size_3-of-12">
                  <lightning-combobox
                    label="Field"
                    value={filter.fieldName}
                    options={fieldOptions}
                    data-id={filter.id}
                    data-name="fieldName"
                    onchange={handleFilterChange}
                    required
                  >
                  </lightning-combobox>
                </div>

                <div class="slds-col slds-size_3-of-12">
                  <lightning-combobox
                    label="Operator"
                    value={filter.operator}
                    options={operatorOptions}
                    data-id={filter.id}
                    data-name="operator"
                    onchange={handleFilterChange}
                    required
                  >
                  </lightning-combobox>
                </div>

                <div class="slds-col slds-size_5-of-12">
                  <lightning-input
                    label="Value"
                    value={filter.value}
                    data-id={filter.id}
                    data-name="value"
                    onchange={handleFilterChange}
                    placeholder="Enter value"
                    required
                  >
                  </lightning-input>
                </div>

                <div class="slds-col slds-size_1-of-12">
                  <lightning-button-icon
                    icon-name="utility:delete"
                    variant="border-filled"
                    alternative-text="Remove condition"
                    data-id={filter.id}
                    onclick={handleRemoveFilter}
                  >
                  </lightning-button-icon>
                </div>
              </div>
            </template>
          </div>
        </template>

        <template if:false={filters.length}>
          <div class="slds-m-top_small slds-text-color_weak">
            <p>No conditions added. Click "Add Condition" to filter results.</p>
          </div>
        </template>
      </div>

      <lightning-input
        type="number"
        name="limit"
        label="Limit"
        value={limitValue}
        onchange={handleLimitChange}
        min="1"
        max="2000"
        class="slds-var-m-top_small"
      >
      </lightning-input>

      <div class="slds-var-m-top_medium">
        <lightning-button
          id="execute-query-button"
          variant="brand"
          label="Execute Query"
          onclick={handleRunQuery}
          disabled={isLoading}
        >
        </lightning-button>
      </div>
      <template if:true={isLoading}>
        <div class="slds-var-m-top_small">
          <lightning-spinner
            alternative-text="Loading"
            size="small"
          ></lightning-spinner>
        </div>
      </template>
    </div>
  </lightning-card>
</template>
